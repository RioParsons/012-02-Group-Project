<%- include ('../partials/header') %>
<%- include ('../partials/menu') %>

<main>
    <div class="col">
        <%- include ('../partials/message') %>
    </div>
    <header class="bg-dark py-5">
        <div class="container px-4 px-lg-5 my-5">
            <div class="text-center text-white">
                <h1 class="display-4 fw-bolder">Daily Deals</h1>
                <p class="lead fw-normal text-white-50 mb-0">Stretch your paycheck by finding the best deals during Happy Hours and more!</p>
            </div>
        </div>
    </header>
    <h4 class="container px-4 px-lg-5 mt-5">Filter Deals</h4>
        <div class="container px-4 px-lg-5">
                <tr>
                    <label style="margin-right: 20px"> <input name="Happy Hour" type="checkbox" id="happy-hour" checked> Happy Hour </label>
                    <label style="margin-right: 20px"> <input name="Meal Combo" type="checkbox" id="meal-combo" checked> Meal Combo </label>
                </tr> 
            <br>
            <button class="btn btn-outline-dark mt-auto" onclick="filterDeals()"> Filter </button>
        </div>
    <div class="container">
        <!-- THE REST OF YOUR HTML CODE GOES HERE -->
        <div class="container px-4 px-lg-5 mt-5">
        
            <% const date = new Date(); %>
            <% let date_str = ""; %>
            <% let day = date.getDate(); %>
            <% let month = date.getMonth() + 1; %>
            <% let weekday = date.getDay(); %>
            <% let wday_str = ""; %>

            <% console.log(date); %>
            <% console.log(day); %>
            <% console.log(month); %>
            <% console.log(weekday); %>

            <% if (weekday == 0) { %>
                <% date_str = "Sunday, "; %>
                <% wday_str = "Sunday"; %>
            <% } else if(weekday == 1) { %>
                <% date_str = "Monday, "; %>
                <% wday_str = "Monday"; %>
            <% } else if(weekday == 2) { %>
                <% date_str = "Tuesday, "; %>
                <% wday_str = "Tuesday"; %>
            <% } else if(weekday == 3) { %>
                <% date_str = "Wednesday, "; %>
                <% wday_str = "Wednesday"; %>
            <% } else if(weekday == 4) { %>
                <% date_str = "Thursday, "; %>
                <% wday_str = "Thursday"; %>
            <% } else if(weekday == 5) { %>
                <% date_str = "Friday, "; %>
                <% wday_str = "Friday"; %>
            <% } else if(weekday == 6) { %>
                <% date_str = "Saturday, "; %>
                <% wday_str = "Saturday"; %>
            <% } else { %>
                <% date_str = "ERROR, "; %>
            <% } %>
            
            <% if(month == 1) { %>
                <% date_str = date_str.concat("January "); %>
            <% } else if (month == 2) { %>
                date_str = date_str.concat("February ");
            <% } else if (month == 3) { %>
                <% date_str = date_str.concat("March "); %>
            <% } else if (month == 4) { %>
                <% date_str = date_str.concat("April "); %>
            <% } else if (month == 5) { %>
                <% date_str = date_str.concat("May "); %>
            <% } else if (month == 6) { %>
                <% date_str = date_str.concat("June "); %>
            <% } else if (month == 7) { %>
                <% date_str = date_str.concat("July "); %>
            <% } else if (month == 8) { %>
                <% date_str = date_str.concat("August "); %>
            <% } else if (month == 9) { %>
                <% date_str = date_str.concat("September "); %>
            <% } else if (month == 10) { %>
                <% date_str = date_str.concat("October "); %>
            <% } else if (month == 11) { %>
                <% date_str = date_str.concat("November "); %>
            <% } else if (month == 12) { %>
                <% date_str = date_str.concat("December "); %>
            <% } else { %>
                <% date_str = date_str.concat("ERROR "); %>
            <% } %>

            <% date_str = date_str.concat(day.toString()); %>

            <% console.log(date); %>
            <% console.log(day); %>
            <% console.log(month); %>
            <% console.log(date_str); %>

            <h2> <%= date_str %> </h2>
              <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                    <% if (data) { %>
                        <% data[0].forEach(function(deal){ %>
                            <% if(deal.day.includes(wday_str)) { %>
                                <div class="col mb-5" name="deal">
                                    <div class="card h-100">
                                        <img src=<%=deal.image_url%> class="card-img-top" alt="Restaurant Image" height= 150>
                                        <div class="card-body">
                                            <div class="text-center">
                                                <h5 class="card-title"><%=deal.deal_title%> at <%=deal.restaurant_name%></h5>
                                                <h6 class="card-subtitle mb-2 text-muted"><%=wday_str%> at <%=deal.time%></h6> 
                                                <p class="card-text"><%=deal.deal_description%></p>
                                            </div>
                                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                                <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="/restaurant/<%= deal.restaurant_id %>">Learn More</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                        <% }) %>
                    <% } %>  
                </div>
        </div>
        <div class="container px-4 px-lg-5 mt-5">
         
            <% const new_date = new Date(); %>
            <% new_date.setDate(day + 1) %>
            <% day = new_date.getDate(); %>
            <% month = new_date.getMonth() + 1; %>
            <% weekday = new_date.getDay(); %>

            <% if (weekday == 0) { %>
                <% date_str = "Sunday, "; %>
                <% wday_str = "Sunday"; %>
            <% } else if(weekday == 1) { %>
                <% date_str = "Monday, "; %>
                <% wday_str = "Monday"; %>
            <% } else if(weekday == 2) { %>
                <% date_str = "Tuesday, "; %>
                <% wday_str = "Tuesday"; %>
            <% } else if(weekday == 3) { %>
                <% date_str = "Wednesday, "; %>
                <% wday_str = "Wednesday"; %>
            <% } else if(weekday == 4) { %>
                <% date_str = "Thursday, "; %>
                <% wday_str = "Thursday"; %>
            <% } else if(weekday == 5) { %>
                <% date_str = "Friday, "; %>
                <% wday_str = "Friday"; %>
            <% } else if(weekday == 6) { %>
                <% date_str = "Saturday, "; %>
                <% wday_str = "Saturday"; %>
            <% } else { %>
                <% date_str = "ERROR, "; %>
            <% } %>
            
            <% if(month == 1) { %>
                <% date_str = date_str.concat("January "); %>
            <% } else if (month == 2) { %>
                date_str = date_str.concat("February ");
            <% } else if (month == 3) { %>
                <% date_str = date_str.concat("March "); %>
            <% } else if (month == 4) { %>
                <% date_str = date_str.concat("April "); %>
            <% } else if (month == 5) { %>
                <% date_str = date_str.concat("May "); %>
            <% } else if (month == 6) { %>
                <% date_str = date_str.concat("June "); %>
            <% } else if (month == 7) { %>
                <% date_str = date_str.concat("July "); %>
            <% } else if (month == 8) { %>
                <% date_str = date_str.concat("August "); %>
            <% } else if (month == 9) { %>
                <% date_str = date_str.concat("September "); %>
            <% } else if (month == 10) { %>
                <% date_str = date_str.concat("October "); %>
            <% } else if (month == 11) { %>
                <% date_str = date_str.concat("November "); %>
            <% } else if (month == 12) { %>
                <% date_str = date_str.concat("December "); %>
            <% } else { %>
                <% date_str = date_str.concat("ERROR "); %>
            <% } %>

            <% date_str = date_str.concat(day.toString()); %>

            <h2> <%= date_str %> </h2>
              <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                    <% if (data) { %>
                        <% data[0].forEach(function(deal){ %>
                            <% if(deal.day.includes(wday_str)) { %>
                                <div class="col mb-5" name="deal">
                                    <div class="card h-100">
                                        <img src=<%=deal.image_url%> class="card-img-top" alt="Restaurant Image" height= 150>
                                        <div class="card-body">
                                            <div class="text-center">
                                                <h5 class="card-title"><%=deal.deal_title%> at <%=deal.restaurant_name%></h5>
                                                <h6 class="card-subtitle mb-2 text-muted"><%=wday_str%> at <%=deal.time%></h6> 
                                                <p class="card-text"><%=deal.deal_description%></p>
                                            </div>
                                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                                <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="/restaurant/<%= deal.restaurant_id %>">Learn More</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                        <% }) %>
                    <% } %>  
            </div>
        </div>
    </div> 
    <script>
        function filterDeals(){
            var happyhour = document.querySelector('#happy-hour');
            var mealcombo = document.querySelector('#meal-combo');
            var deals = document.getElementsByName("deal");
            for (i=0; i < deals.length; i++){
                var title = deals[i].getElementsByClassName("card-title");
                var type = title[0].textContent.toUpperCase();
                if (type.includes("HAPPY HOUR") & happyhour.checked == true){
                    deals[i].style.display = "";
                } else if (type.includes("MEAL COMBO") & mealcombo.checked== true) {
                    deals[i].style.display = "";
                } else {
                    deals[i].style.display = "none";
                }
            }
        }
    </script>
</main>

<%- include ('../partials/footer') %>